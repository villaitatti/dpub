<link rel="stylesheet" href="../../assets/styles/template.css">

<ol class="page-breadcrumb">
  <li class="active">Letters</li>
</ol>

<div class="page">
  <div class="page__body">

    <semantic-search
    
    categories='{
        "<http://www.w3.org/2001/XMLSchema#date>": [{
          "kind": "date-range",
          "datatype": "http://www.w3.org/2001/XMLSchema#date",
          "queryPattern": "
            {
              $subject ?__relation__ ?date .
              FILTER(?date <= ?__dateEndValue__) .
              FILTER(?date >= ?__dateBeginValue__) .
            }"
          }]
        }'    

      relations = '{
          "<mpp:letter_sender>": [
            {
              "kind": "resource",
              "queryPattern": "
                {
                  ?subject crm:P1_is_identified_by ?letter.
                  ?activity crm:P16_used_specific_object ?letter.
                  ?activity crm:P01_has_domain ?carry_by_sender.
                  ?carry_by_sender crm:P14.1_in_the_role_of ?sender_role.
                  ?sender_role rdfs:label \"Sender\".
                  ?carry_by_sender crm:P02_has_range ?__value__.
                }"
            }
          ],
          "<mpp:letter_receiver>": [
            {
              "kind": "resource",
              "queryPattern": "
                {
                  ?subject crm:P1_is_identified_by ?letter.
                  ?activity crm:P16_used_specific_object ?letter.
                  ?activity crm:P01_has_domain ?receiver_carry.
                  ?receiver_carry crm:P14.1_in_the_role_of ?receiver_role.
                  ?receiver_role rdfs:label \"Receiver\".
                  ?receiver_carry crm:P02_has_range ?__value__.
                }"
            }
          ],
          "<mpp:date>":[
            {
              "kind": "date-range",
              "queryPattern": "
              {
                ?subject crm:P1_is_identified_by ?letter.
                ?activity crm:P16_used_specific_object ?letter.

                ?production crm:P9i_forms_part_of ?activity.
                ?production a crm:E12_Production.

                ?production crm:P4_has_time_span ?prod_ts.
  				      ?prod_ts crm:P81a_end_of_the_begin ?literal
                FILTER(?literal >= ?__dateBeginValue__) .
                FILTER(?literal <= ?__dateEndValue__) .
              }"
            }
          ],
          "<mpp:place>":[
            {
              "kind": "resource",
              "queryPattern": "
              {
                ?subject crm:P1_is_identified_by ?letter.
                ?prod crm:P108_has_produced ?letter.
  				      ?prod crm:P7_took_place_at ?__value__
              }"
            }
          ]
        }'
      
      search-profile='{ 
        "categories": [
          {
            "iri": "<https://www.researchspace.org/resource/TextDocuments>",
            "label": "Letter",
            "thumbnail": "../../../assets/images/user.svg"
          },
          {
            "iri":"<crm:E21_Person>",
            "label":"Person",
            "thumbnail": "../../../assets/images/user.svg"
          },
          {
            "iri": "<http://www.w3.org/2001/XMLSchema#date>",
            "label": "Date",
            "thumbnail": "../../../assets/images/calendar.svg"
          },
          {
            "iri": "<crm:E53_Place>",
            "label": "Place",
            "thumbnail": "../../../assets/images/map-marker.svg"
          }
        ],
        "relations": [
          {
            "iri": "<mpp:letter_sender>",
            "label": "Sender",
            "hasDomain": "<https://www.researchspace.org/resource/TextDocuments>",
            "hasRange": "<crm:E21_Person>"
          },
          {
            "iri": "<mpp:letter_receiver>",
            "label": "Receiver",
            "hasDomain": "<https://www.researchspace.org/resource/TextDocuments>",
            "hasRange": "<crm:E21_Person>"
          },
          {
            "iri": "<mpp:date>",
            "label": "Year",
            "hasDomain": "<https://www.researchspace.org/resource/TextDocuments>",
            "hasRange": "<http://www.w3.org/2001/XMLSchema#date>"
          },
          {
            "iri": "<mpp:place>",
            "label": "Sending Place",
            "hasDomain": "<https://www.researchspace.org/resource/TextDocuments>",
            "hasRange": "<crm:E53_Place>" 
          }
        ]
      }'
    >
      <semantic-search-query-constant 
        domain='<https://www.researchspace.org/resource/TextDocuments>'
        query="
          SELECT ?subject WHERE { 
            ?subject a yashiro-annotation:TextDocument . 
          }">
      </semantic-search-query-constant>
      
      <div data-flex-layout="row stretch-stretch">
        <div data-flex-self="size-1of3" style="flex: 0 0 20px;">
          <semantic-search-facet open-by-default="true"></semantic-search-facet>
        </div>
        
        <semantic-search-result-holder>
          <div data-flex-self="md-full">

            <!--
            <semantic-search-result>
              <mp-sparql-result-counts id='query-count'
                                       query="SELECT DISTINCT * {}"
                                       template='{{#if hasLimit}} <bs-alert bs-style="warning">
                                                 Showing {{numberOfResults}} of {{totalNumberOfResults}} matches. <strong>Please, refine your search.</strong> </bs-alert>
                                                 {{else}}<span> found {{numberOfResults}} matches </span>{{/if}}'>
              </mp-sparql-result-counts>
            </semantic-search-result>-->
  
            <bs-tabs unmount-on-exit=true id='search-results' animation=false>
              
              <bs-tab event-key="1" title="table">
                <semantic-table
                  id="table-result"
                  query='
                    SELECT DISTINCT ?subject ?sender ?receiver ?date ?place_label WHERE {

                      ?subject crm:P1_is_identified_by ?letter.
                      ?activity crm:P16_used_specific_object ?letter.

                      ?sending crm:P9i_forms_part_of ?activity.
                      ?sending crm:P7_took_place_at ?place.
                      ?place rdfs:label ?place_label.

                      ?sending crm:P4_has_time_span ?activity_timespan.
                      ?activity_timespan crm:P81a_end_of_the_begin ?date.
                      
                      ?activity crm:P01_has_domain ?sender_carry.
                      ?sender_carry crm:P02_has_range ?sender_person.
                      ?sender_person rdfs:label ?sender.
                      ?sender_carry crm:P14.1_in_the_role_of ?sender_role.
                      ?sender_role rdfs:label "Sender".
                      
                      ?activity crm:P01_has_domain ?receiver_carry.
                      ?receiver_carry crm:P02_has_range ?receiver_person.
                      ?receiver_person rdfs:label ?receiver.
                      ?receiver_carry crm:P14.1_in_the_role_of ?receiver_role.
                      ?receiver_role rdfs:label "Receiver"
                    }'
                    column-configuration='[
                      {"displayName": "Letter", "cellTemplate": "<semantic-link iri={{subject.value}}></semantic-link>"},
                      {"variableName": "date",      "displayName": "Sent at"},
                      {"variableName": "sender",    "displayName": "From"},
                      {"variableName": "place_label", "displayName": "In"},
                      {"variableName": "receiver",  "displayName": "To"}
                    ]'
                  >
                  
                </semantic-table>
              </bs-tab>

              <bs-tab event-key="2" title="Grid">
                <semantic-search-result>
                  <semantic-table 
                    id='grid-result'
                    number-of-displayed-rows='9'
                    query='
                      SELECT DISTINCT ?subject ?sender ?receiver ?date ?place_label WHERE {

                        ?subject crm:P1_is_identified_by ?letter.
                        ?activity crm:P16_used_specific_object ?letter.

                        ?sending crm:P9i_forms_part_of ?activity.
                        ?sending crm:P7_took_place_at ?place.
                        ?place rdfs:label ?place_label.

                        ?sending crm:P4_has_time_span ?activity_timespan.
      					        ?activity_timespan crm:P81a_end_of_the_begin ?date.
                        
                        ?activity crm:P01_has_domain ?sender_carry.
                        ?sender_carry crm:P02_has_range ?sender_person.
                        ?sender_person rdfs:label ?sender.
                        ?sender_carry crm:P14.1_in_the_role_of ?sender_role.
                        ?sender_role rdfs:label "Sender".
                        
                        ?activity crm:P01_has_domain ?receiver_carry.
                        ?receiver_carry crm:P02_has_range ?receiver_person.
                        ?receiver_person rdfs:label ?receiver.
                        ?receiver_carry crm:P14.1_in_the_role_of ?receiver_role.
                        ?receiver_role rdfs:label "Receiver"
                      }'
                    tuple-template='{{>tupleTemplate}}'>

                    <template id='tupleTemplate'>
                        
                        <div class="rs-grid-element panel panel-default">
                          
                          <div class="panel-body">

                            <div data-flex-layout="row stretch-stretch">
                              <div class="grid-demo" data-flex-layout="column center-center">
                                <mp-resource-thumbnail iri='{{subject.value}}' no-image-uri='../../assets/images/yashiro.jpg' class="thumbnail"/>
                              </div>
                              <div data-flex-layout="column top-stretch">

                                <div class="grid-demo">
                                  <h5><semantic-link iri="{{subject.value}}"></semantic-link></h5>
                                </div>
                                
                                <div class="grid-demo">
                                  <b>Sent: </b>{{date.value}}
                                </div>

                                <div class="grid-demo">
                                  <b>From: </b>{{sender.value}}
                                </div>

                                <div class="grid-demo">
                                  <b>To: </b>{{receiver.value}}
                                </div>

                                <div class="grid-demo">
                                  <b>In: </b>{{place_label.value}}
                                </div> 
                              </div>
                              
                            </div>
          
                          </div>

                        </div>

                    </template>

                  </semantic-table>
                </semantic-search-result>
              </bs-tab>
            </bs-tabs>
             
          </div>
        </semantic-search-result-holder>

      </div>
    </semantic-search>

  </div>
</div>